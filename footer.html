<script>
    /**
     * Telegram —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Æ–ö–∞—Å—Å—ã
     * –†–ê–ó–ú–ï–©–ï–ù–ò–ï: –í FOOTER —Å–∞–π—Ç–∞ (–ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º </body>)
     */

    console.log('[TELEGRAM] üöÄ –°–∫—Ä–∏–ø—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Æ–ö–∞—Å—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω');

    const TELEGRAM_BOT_TOKEN = '8111231642:AAE6FjAyI5B_zMcokXQ1KPpSU7ZZ2S76DXI';
    const TELEGRAM_CHAT_ID = '481014845';

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ base64 –≤ Blob
    function base64ToBlob(base64Data, contentType = '') {
        const byteCharacters = atob(base64Data.split(',')[1]);
        const byteNumbers = new Array(byteCharacters.length);

        for (let i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
        }

        const byteArray = new Uint8Array(byteNumbers);
        return new Blob([byteArray], { type: contentType });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ —Ñ–æ—Ä–º
    function getCustomerData() {
        const customerData = {
            name: '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
            email: '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
            phone: '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
        };

        console.log('[TELEGRAM] üîç –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞...');

        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–º —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º
        const nameSelectors = [
            'input[name="name"]',
            'input[name="Name"]',
            'input[name="firstname"]',
            'input[name="FirstName"]',
            'input[placeholder*="–∏–º—è"]',
            'input[placeholder*="–ò–º—è"]',
            'input[data-tilda-rule="name"]',
            'input[data-field="name"]',
            '.js-tilda-rule input[data-tilda-rule="name"]',
            '.t-input[data-tilda-rule="name"]'
        ];

        const emailSelectors = [
            'input[name="email"]',
            'input[name="Email"]',
            'input[type="email"]',
            'input[data-tilda-rule="email"]',
            'input[data-field="email"]',
            '.js-tilda-rule input[data-tilda-rule="email"]',
            '.t-input[data-tilda-rule="email"]'
        ];

        const phoneSelectors = [
            'input[name="phone"]',
            'input[name="Phone"]',
            'input[name="tel"]',
            'input[type="tel"]',
            'input[data-tilda-rule="phone"]',
            'input[data-field="phone"]',
            '.js-tilda-rule input[data-tilda-rule="phone"]',
            '.t-input[data-tilda-rule="phone"]'
        ];

        // –ü–æ–∏—Å–∫ –∏–º–µ–Ω–∏
        for (const selector of nameSelectors) {
            const element = document.querySelector(selector);
            if (element && element.value && element.value.trim()) {
                customerData.name = element.value.trim();
                console.log('[TELEGRAM] ‚úÖ –ò–º—è –Ω–∞–π–¥–µ–Ω–æ:', customerData.name, '—á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä:', selector);
                break;
            }
        }

        // –ü–æ–∏—Å–∫ email
        for (const selector of emailSelectors) {
            const element = document.querySelector(selector);
            if (element && element.value && element.value.trim()) {
                customerData.email = element.value.trim();
                console.log('[TELEGRAM] ‚úÖ Email –Ω–∞–π–¥–µ–Ω:', customerData.email, '—á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä:', selector);
                break;
            }
        }

        // –ü–æ–∏—Å–∫ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        for (const selector of phoneSelectors) {
            const element = document.querySelector(selector);
            if (element && element.value && element.value.trim()) {
                customerData.phone = element.value.trim();
                console.log('[TELEGRAM] ‚úÖ –¢–µ–ª–µ—Ñ–æ–Ω –Ω–∞–π–¥–µ–Ω:', customerData.phone, '—á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä:', selector);
                break;
            }
        }

        // –ü–æ–∏—Å–∫ –≤ –∫–æ—Ä–∑–∏–Ω–µ ST100
        const cartForm = document.querySelector('.js-store-cart-form, .js-cart-form');
        if (cartForm) {
            console.log('[TELEGRAM] üõí –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º—É –∫–æ—Ä–∑–∏–Ω—ã ST100');

            const cartNameField = cartForm.querySelector('input[name="name"], input[data-tilda-rule="name"]');
            const cartEmailField = cartForm.querySelector('input[name="email"], input[data-tilda-rule="email"]');
            const cartPhoneField = cartForm.querySelector('input[name="phone"], input[data-tilda-rule="phone"]');

            if (cartNameField && cartNameField.value && cartNameField.value.trim()) {
                customerData.name = cartNameField.value.trim();
                console.log('[TELEGRAM] ‚úÖ –ò–º—è –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω–µ:', customerData.name);
            }
            if (cartEmailField && cartEmailField.value && cartEmailField.value.trim()) {
                customerData.email = cartEmailField.value.trim();
                console.log('[TELEGRAM] ‚úÖ Email –Ω–∞–π–¥–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω–µ:', customerData.email);
            }
            if (cartPhoneField && cartPhoneField.value && cartPhoneField.value.trim()) {
                customerData.phone = cartPhoneField.value.trim();
                console.log('[TELEGRAM] ‚úÖ –¢–µ–ª–µ—Ñ–æ–Ω –Ω–∞–π–¥–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω–µ:', customerData.phone);
            }
        }

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        try {
            const savedCustomerData = localStorage.getItem('tilda_customer_data');
            if (savedCustomerData) {
                const parsed = JSON.parse(savedCustomerData);
                if (parsed.name && parsed.name !== '–ù–µ —É–∫–∞–∑–∞–Ω–æ') customerData.name = parsed.name;
                if (parsed.email && parsed.email !== '–ù–µ —É–∫–∞–∑–∞–Ω–æ') customerData.email = parsed.email;
                if (parsed.phone && parsed.phone !== '–ù–µ —É–∫–∞–∑–∞–Ω–æ') customerData.phone = parsed.phone;
                console.log('[TELEGRAM] ‚úÖ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage:', parsed);
            }
        } catch (error) {
            console.log('[TELEGRAM] ‚ö†Ô∏è –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞:', error);
        }

        console.log('[TELEGRAM] üìã –ò—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞:', customerData);
        return customerData;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞ –∏–∑ localStorage
    function getOrderNumber() {
        const savedOrderId = localStorage.getItem('tilda_order_id');
        if (savedOrderId) {
            console.log('[TELEGRAM] üé´ –ù–∞–π–¥–µ–Ω –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:', savedOrderId);
            return savedOrderId;
        }

        console.log('[TELEGRAM] ‚ö†Ô∏è –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return '';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç Tilda API
    function interceptTildaResponse() {
        console.log('[TELEGRAM] üîß –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç API –æ—Ç–≤–µ—Ç–æ–≤...');

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º fetch –∑–∞–ø—Ä–æ—Å—ã
        const originalFetch = window.fetch;
        window.fetch = async function (...args) {
            const response = await originalFetch.apply(this, args);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –ª–∏ –∑–∞–ø—Ä–æ—Å –∫ Tilda API
            const url = args[0] ? args[0].toString() : '';
            if (url.includes('forms.tildaapi.com/procces/')) {
                console.log('[TELEGRAM] üîç –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω –∑–∞–ø—Ä–æ—Å –∫ Tilda API:', url);

                // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
                const requestData = args[1];
                if (requestData && requestData.body) {
                    console.log('[TELEGRAM] üì§ –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞:', requestData.body);

                    try {
                        // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                        const formData = new URLSearchParams(requestData.body);

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
                        const customerData = {
                            name: formData.get('name') || formData.get('Name') || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                            email: formData.get('email') || formData.get('Email') || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                            phone: formData.get('phone') || formData.get('Phone') || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
                        };

                        // –ò—â–µ–º —Ü–µ–Ω—É –≤ –¥–∞–Ω–Ω—ã—Ö
                        let totalPrice = 0;
                        for (const [key, value] of formData.entries()) {
                            if (key.includes('price') || key.includes('Price') || key.includes('total')) {
                                const priceMatch = value.match(/[\d.,]+/);
                                if (priceMatch) {
                                    totalPrice = parseFloat(priceMatch[0].replace(',', '.'));
                                    console.log('[TELEGRAM] üí∞ –¶–µ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ:', totalPrice);
                                }
                            }
                        }

                        console.log('[TELEGRAM] üë§ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞:', customerData);

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
                        localStorage.setItem('tilda_customer_data', JSON.stringify(customerData));
                        if (totalPrice > 0) {
                            localStorage.setItem('tilda_order_price', totalPrice.toString());
                        }

                    } catch (error) {
                        console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞:', error);
                    }
                }

                try {
                    // –ö–ª–æ–Ω–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è
                    const clonedResponse = response.clone();
                    const responseText = await clonedResponse.text();

                    console.log('[TELEGRAM] üì• –û—Ç–≤–µ—Ç –æ—Ç Tilda:', responseText);

                    // –ü–∞—Ä—Å–∏–º JSON –æ—Ç–≤–µ—Ç
                    const responseData = JSON.parse(responseText);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ results –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
                    if (responseData.results && responseData.results.length > 0) {
                        const orderNumber = responseData.results[0];
                        console.log('[TELEGRAM] üé´ –ù–∞–π–¥–µ–Ω –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:', orderNumber);

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –≤ localStorage
                        localStorage.setItem('tilda_order_id', orderNumber);
                        console.log('[TELEGRAM] üíæ –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage');
                    } else {
                        console.log('[TELEGRAM] ‚ö†Ô∏è –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ');
                    }

                } catch (error) {
                    console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞:', error);
                }
            }

            return response;
        };

        // –¢–∞–∫–∂–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º XMLHttpRequest
        const originalXHR = window.XMLHttpRequest;
        function newXHR() {
            const xhr = new originalXHR();
            const originalSend = xhr.send;

            xhr.send = function (data) {
                // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞
                if (xhr._method === 'POST' && xhr._url && xhr._url.includes('forms.tildaapi.com/procces/')) {
                    console.log('[TELEGRAM] üîç –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω XHR POST –∑–∞–ø—Ä–æ—Å:', xhr._url);
                    console.log('[TELEGRAM] üì§ –î–∞–Ω–Ω—ã–µ XHR –∑–∞–ø—Ä–æ—Å–∞:', data);

                    if (data) {
                        try {
                            const formData = new URLSearchParams(data);

                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
                            const customerData = {
                                name: formData.get('name') || formData.get('Name') || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                email: formData.get('email') || formData.get('Email') || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                                phone: formData.get('phone') || formData.get('Phone') || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
                            };

                            // –ò—â–µ–º —Ü–µ–Ω—É –≤ –¥–∞–Ω–Ω—ã—Ö
                            let totalPrice = 0;
                            for (const [key, value] of formData.entries()) {
                                if (key.includes('price') || key.includes('Price') || key.includes('total')) {
                                    const priceMatch = value.match(/[\d.,]+/);
                                    if (priceMatch) {
                                        totalPrice = parseFloat(priceMatch[0].replace(',', '.'));
                                        console.log('[TELEGRAM] üí∞ –¶–µ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ XHR –∑–∞–ø—Ä–æ—Å–µ:', totalPrice);
                                    }
                                }
                            }

                            console.log('[TELEGRAM] üë§ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ XHR –∑–∞–ø—Ä–æ—Å–∞:', customerData);

                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
                            localStorage.setItem('tilda_customer_data', JSON.stringify(customerData));
                            if (totalPrice > 0) {
                                localStorage.setItem('tilda_order_price', totalPrice.toString());
                            }

                        } catch (error) {
                            console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ XHR –¥–∞–Ω–Ω—ã—Ö:', error);
                        }
                    }
                }

                // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
                xhr.addEventListener('load', function () {
                    if (xhr.responseURL && xhr.responseURL.includes('forms.tildaapi.com/procces/')) {
                        console.log('[TELEGRAM] üì• –ü–æ–ª—É—á–µ–Ω XHR –æ—Ç–≤–µ—Ç –æ—Ç Tilda API:', xhr.responseURL);

                        try {
                            const responseText = xhr.responseText;
                            console.log('[TELEGRAM] üì• XHR –æ—Ç–≤–µ—Ç –æ—Ç Tilda:', responseText);

                            const responseData = JSON.parse(responseText);

                            if (responseData.results && responseData.results.length > 0) {
                                const orderNumber = responseData.results[0];
                                console.log('[TELEGRAM] üé´ –ù–∞–π–¥–µ–Ω –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ XHR:', orderNumber);

                                localStorage.setItem('tilda_order_id', orderNumber);
                                console.log('[TELEGRAM] üíæ –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage —á–µ—Ä–µ–∑ XHR');
                            }
                        } catch (error) {
                            console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ XHR –æ—Ç–≤–µ—Ç–∞:', error);
                        }
                    }
                });

                return originalSend.apply(this, arguments);
            };

            return xhr;
        }

        window.XMLHttpRequest = newXHR;
        console.log('[TELEGRAM] ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç API —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (fetch + XHR)');
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞ –≤ Telegram
    async function sendOrderToTelegram() {
        console.log('[TELEGRAM] üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–∫–∞–∑–∞...');

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
        const customer = getCustomerData();

        // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
        const orderNumber = getOrderNumber();

        let message = 'üéâ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å –Æ–ö–∞—Å—Å—ã!\n\n';

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
        if (orderNumber) {
            message += `üìã –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: ${orderNumber}\n\n`;
        }

        message += `üë§ –ö–ª–∏–µ–Ω—Ç: ${customer.name}\n`;
        message += `üìß Email: ${customer.email}\n`;
        message += `üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${customer.phone}\n`;
        message += `üìÖ –î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}\n\n`;

        let files = [];
        let totalAmount = 0;

        // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –∏–∑ IndexedDB
        if (window.TildaCartDB) {
            try {
                const db = new TildaCartDB();
                await db.init();
                const products = await db.getAllProducts();

                if (products.length > 0) {
                    message += `üõçÔ∏è –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ:\n`;
                    products.forEach((product, i) => {
                        message += `\n${i + 1}. ${product.productName || '–¢–æ–≤–∞—Ä'}\n`;
                        if (product.text) {
                            message += `üìù –¢–µ–∫—Å—Ç: ${product.text}\n`;
                        }
                        message += `üè∑Ô∏è SKU: ${product.sku || '–ù–µ —É–∫–∞–∑–∞–Ω'}\n`;
                        message += `üì¶ –ö–æ–ª-–≤–æ: 1\n`;

                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É –∏–∑ IndexedDB
                        const productPrice = product.price || '0';
                        message += `üí∞ –¶–µ–Ω–∞: ${productPrice} –†–£–ë\n`;

                        // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ
                        const priceNumber = parseFloat(productPrice.toString().replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
                        totalAmount += priceNumber;

                        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∞–π–ª
                        if (product.file && product.file.data) {
                            const blob = base64ToBlob(product.file.data, product.file.type);
                            files.push({
                                name: product.file.name || 'file.jpg',
                                blob: blob,
                                productName: product.productName || '–¢–æ–≤–∞—Ä'
                            });
                            message += `üìé –ö —Ç–æ–≤–∞—Ä—É –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω —Ñ–∞–π–ª\n`;
                        }
                    });

                    if (files.length > 0) {
                        message += `\nüìÅ –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: ${files.length}\n`;
                    }

                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—É—é –æ–±—â—É—é —Å—É–º–º—É
                    message += `\nüí∏ –û–±—â–∞—è —Å—É–º–º–∞: ${totalAmount} –†–£–ë\n`;
                    message += `‚úÖ –°—Ç–∞—Ç—É—Å: –û–ü–õ–ê–ß–ï–ù–û —á–µ—Ä–µ–∑ –Æ–ö–∞—Å—Å—É\n`;

                    console.log('[TELEGRAM] üí∞ –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—É–º–º–∞:', totalAmount);

                } else {
                    message += `‚ö†Ô∏è –¢–æ–≤–∞—Ä—ã: –ù–µ –Ω–∞–π–¥–µ–Ω—ã –≤ IndexedDB\n`;
                }
            } catch (error) {
                console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤:', error);
                message += `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤: ${error.message}\n`;
            }
        } else {
            message += `‚ö†Ô∏è IndexedDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω\n`;
        }

        try {
            // 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: message
                })
            });

            const result = await response.json();
            if (!result.ok) {
                console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', result.description);
                return false;
            }

            console.log('[TELEGRAM] ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');

            // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã
            if (files.length > 0) {
                for (let fileObj of files) {
                    const formData = new FormData();
                    formData.append('chat_id', TELEGRAM_CHAT_ID);
                    formData.append('caption', `üñºÔ∏è ${fileObj.productName} - ${fileObj.name}`);
                    formData.append('document', fileObj.blob, fileObj.name);

                    try {
                        const fileResp = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendDocument`, {
                            method: 'POST',
                            body: formData
                        });

                        const fileJson = await fileResp.json();
                        if (fileJson.ok) {
                            console.log('[TELEGRAM] ‚úÖ –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:', fileObj.name);
                        } else {
                            console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞:', fileJson.description);
                        }
                    } catch (fileError) {
                        console.error('[TELEGRAM] ‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ —Ñ–∞–π–ª–∞:', fileError);
                    }
                }
            }

            // 3. –û—á–∏—â–∞–µ–º IndexedDB –∏ –¥–∞–Ω–Ω—ã–µ
            if (window.TildaCartDB) {
                try {
                    const db = new TildaCartDB();
                    await db.init();
                    await db.clearAllProducts();
                    console.log('[TELEGRAM] üóëÔ∏è IndexedDB –æ—á–∏—â–µ–Ω');

                    // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    localStorage.removeItem('tilda_order_id');
                    localStorage.removeItem('tilda_customer_data');
                    localStorage.removeItem('tilda_order_price');
                    console.log('[TELEGRAM] üóëÔ∏è –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ –æ—á–∏—â–µ–Ω—ã');
                } catch (error) {
                    console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ IndexedDB:', error);
                }
            }

            return true;

        } catch (error) {
            console.error('[TELEGRAM] ‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞:', error);
            return false;
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –Æ–ö–∞—Å—Å—É
    function watchYooKassaPayment() {
        console.log('[TELEGRAM] üîç –ó–∞–ø—É—Å–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–ø–ª–∞—Ç—ã –Æ–ö–∞—Å—Å—ã...');

        // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        let orderSent = false;

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
        const triggerOrderSend = (source) => {
            if (orderSent) {
                console.log('[TELEGRAM] ‚ö†Ô∏è –ó–∞–∫–∞–∑ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
                return;
            }

            const orderId = getOrderNumber();
            if (!orderId) {
                console.log('[TELEGRAM] ‚ö†Ô∏è –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É');
                return;
            }

            console.log(`[TELEGRAM] üöÄ –¢—Ä–∏–≥–≥–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏: ${source}, orderId: ${orderId}`);
            orderSent = true;

            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
            setTimeout(() => {
                sendOrderToTelegram();
            }, 1000);
        };

        // 1. –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –í–û–ó–í–†–ê–¢–ê –° –Æ–ö–ê–°–°–´
        const checkYooKassaReturn = () => {
            const referrer = document.referrer || '';
            const orderId = localStorage.getItem('tilda_order_id');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–≤—Ä–∞—Ç —Å –Æ–ö–∞—Å—Å—ã
            if (referrer.includes('yoomoney.ru') && orderId) {
                console.log('[TELEGRAM] üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç —Å –Æ–ö–∞—Å—Å—ã');
                console.log('[TELEGRAM] üìÑ Referrer:', referrer);
                console.log('[TELEGRAM] üé´ Order ID:', orderId);

                triggerOrderSend('–≤–æ–∑–≤—Ä–∞—Ç —Å –Æ–ö–∞—Å—Å—ã');
                return true;
            }

            return false;
        };

        // 2. –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï URL –ü–ê–†–ê–ú–ï–¢–†–û–í
        const checkUrlParams = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const hasPaymentSuccess = urlParams.get('payment_success') ||
                urlParams.get('order_paid') ||
                urlParams.get('payment_status') === 'success' ||
                urlParams.get('yukassa_success') === 'true';

            if (hasPaymentSuccess) {
                console.log('[TELEGRAM] üîç –ù–∞–π–¥–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –≤ URL');
                triggerOrderSend('URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã');
                return true;
            }

            return false;
        };

        // 3. –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï postMessage –û–¢ –Æ–ö–ê–°–°–´
        const setupPostMessageListener = () => {
            window.addEventListener('message', (event) => {
                console.log('[TELEGRAM] üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:', event.data, '–æ—Ç:', event.origin);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –Æ–ö–∞—Å—Å—ã
                if (event.origin.includes('yoomoney.ru') || event.origin.includes('yookassa.ru')) {
                    const data = event.data;

                    // –ò—â–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
                    if (typeof data === 'object' && (
                        data.status === 'success' ||
                        data.status === 'succeeded' ||
                        data.type === 'payment_success' ||
                        (data.payment && data.payment.status === 'succeeded')
                    )) {
                        console.log('[TELEGRAM] üîç –ü–æ–ª—É—á–µ–Ω postMessage –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ');
                        triggerOrderSend('postMessage –æ—Ç –Æ–ö–∞—Å—Å—ã');
                    }
                }
            });

            console.log('[TELEGRAM] üëÇ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–ª—É—à–∞—Ç–µ–ª—å postMessage');
        };

        // 4. –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô –í LOCALSTORAGE
        const setupStorageListener = () => {
            const originalSetItem = localStorage.setItem;
            localStorage.setItem = function (key, value) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∑–∞–∫–∞–∑–æ–º
                if (key.includes('order') || key.includes('payment') || key === 'tilda_order_id') {
                    console.log('[TELEGRAM] üíæ localStorage –æ–±–Ω–æ–≤–ª–µ–Ω:', key, '=', value);

                    // –ï—Å–ª–∏ –ø–æ—è–≤–∏–ª—Å—è –Ω–æ–≤—ã–π order_id, –≤–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
                    if (key === 'tilda_order_id' && value && !orderSent) {
                        console.log('[TELEGRAM] üîç –ù–æ–≤—ã–π order_id –≤ localStorage');
                        setTimeout(() => {
                            triggerOrderSend('–Ω–æ–≤—ã–π order_id –≤ localStorage');
                        }, 2000); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    }
                }

                originalSetItem.apply(this, arguments);
            };

            console.log('[TELEGRAM] üëÇ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–ª—É—à–∞—Ç–µ–ª—å localStorage');
        };

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –í–°–ï–• –ú–ï–¢–û–î–û–í –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø

        // –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        setTimeout(() => {
            console.log('[TELEGRAM] üîç –ü–µ—Ä–≤–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞...');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–≤—Ä–∞—Ç —Å –Æ–ö–∞—Å—Å—ã
            if (checkYooKassaReturn()) {
                return; // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            if (checkUrlParams()) {
                return; // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è
            }

        }, 500);

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏
        setupPostMessageListener();
        setupStorageListener();

        console.log('[TELEGRAM] ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –Æ–ö–∞—Å—Å—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        window.forceSendOrder = () => {
            console.log('[TELEGRAM] üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞');
            orderSent = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
            triggerOrderSend('–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤');
        };
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    window.telegramSimple = {
        async sendOrder() {
            console.log('[TELEGRAM] üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞...');
            return await sendOrderToTelegram();
        },

        checkCustomerData() {
            const customer = getCustomerData();
            console.log('[TELEGRAM] üë§ –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞:', customer);
            return customer;
        },

        async checkProducts() {
            if (window.TildaCartDB) {
                try {
                    const db = new TildaCartDB();
                    await db.init();
                    const products = await db.getAllProducts();
                    console.log('[TELEGRAM] üõçÔ∏è –¢–æ–≤–∞—Ä—ã:', products);
                    return products;
                } catch (error) {
                    console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ IndexedDB:', error);
                    return [];
                }
            } else {
                console.log('[TELEGRAM] ‚ö†Ô∏è TildaCartDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                return [];
            }
        },

        checkOrderNumber() {
            const orderNumber = getOrderNumber();
            console.log('[TELEGRAM] üé´ –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:', orderNumber);
            return orderNumber;
        },

        setOrderNumber(orderNumber) {
            localStorage.setItem('tilda_order_id', orderNumber);
            console.log('[TELEGRAM] üíæ –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', orderNumber);
        },

        debugForms() {
            console.log('[TELEGRAM] üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –§–û–†–ú –ù–ê –°–¢–†–ê–ù–ò–¶–ï:');

            const forms = document.querySelectorAll('form');
            console.log(`–ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ä–º: ${forms.length}`);

            forms.forEach((form, i) => {
                console.log(`\nüìù –§–æ—Ä–º–∞ ${i + 1}:`);

                const inputs = form.querySelectorAll('input');
                inputs.forEach(input => {
                    console.log(`  ‚Ä¢ ${input.type || 'text'}: name="${input.name}", value="${input.value}", placeholder="${input.placeholder}"`);
                });
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ input –ø–æ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            console.log('\nüîç –í–°–ï INPUT –ü–û–õ–Ø –ù–ê –°–¢–†–ê–ù–ò–¶–ï:');
            const allInputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[name*="name"], input[name*="email"], input[name*="phone"]');
            allInputs.forEach(input => {
                if (input.value && input.value.trim()) {
                    console.log(`  ‚úÖ ${input.type || 'text'}: name="${input.name}", value="${input.value}", data-tilda-rule="${input.dataset.tildaRule}"`);
                }
            });
        },

        // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ü–µ–Ω –≤ Telegram —Å–∫—Ä–∏–ø—Ç–µ  
        async debugPrices() {
            if (window.TildaCartDB) {
                try {
                    const db = new TildaCartDB();
                    await db.init();
                    const products = await db.getAllProducts();

                    console.log('[TELEGRAM] üí∞ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –¶–ï–ù:');
                    let total = 0;

                    products.forEach((product, i) => {
                        const price = product.price || '0';
                        const priceNumber = parseFloat(price.toString().replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
                        total += priceNumber;

                        console.log(`${i + 1}. ${product.productName}`);
                        console.log(`   –¶–µ–Ω–∞ (—Å—Ç—Ä–æ–∫–∞): "${price}"`);
                        console.log(`   –¶–µ–Ω–∞ (—á–∏—Å–ª–æ): ${priceNumber}`);
                        console.log(`   SKU: ${product.sku}`);
                    });

                    console.log(`üí∏ –ò—Ç–æ–≥–æ: ${total} –†–£–ë`);
                    return { products, total };

                } catch (error) {
                    console.error('[TELEGRAM] ‚ùå –û—à–∏–±–∫–∞ IndexedDB:', error);
                    return { products: [], total: 0 };
                }
            } else {
                console.log('[TELEGRAM] ‚ö†Ô∏è TildaCartDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                return { products: [], total: 0 };
            }
        },

        // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
        debugTracking() {
            console.log('[TELEGRAM] üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø:');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º referrer
            console.log('üìÑ document.referrer:', document.referrer);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            const urlParams = new URLSearchParams(window.location.search);
            console.log('üîó URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', Object.fromEntries(urlParams));

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const orderId = localStorage.getItem('tilda_order_id');
            const customerData = localStorage.getItem('tilda_customer_data');
            console.log('üíæ tilda_order_id:', orderId);
            console.log('üíæ tilda_customer_data:', customerData);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const shouldTrigger = document.referrer.includes('yoomoney.ru') && orderId;
            console.log('üöÄ –î–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä:', shouldTrigger);

            return {
                referrer: document.referrer,
                urlParams: Object.fromEntries(urlParams),
                orderId,
                customerData,
                shouldTrigger
            };
        },

        // –°–∏–º—É–ª—è—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å –Æ–ö–∞—Å—Å—ã
        simulateYooKassaReturn() {
            console.log('[TELEGRAM] üß™ –°–∏–º—É–ª–∏—Ä—É–µ–º –≤–æ–∑–≤—Ä–∞—Ç —Å –Æ–ö–∞—Å—Å—ã...');

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            localStorage.setItem('tilda_order_id', 'TEST_ORDER_' + Date.now());

            // –ò–º–∏—Ç–∏—Ä—É–µ–º referrer (–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Object.defineProperty)
            try {
                Object.defineProperty(document, 'referrer', {
                    value: 'https://yoomoney.ru/checkout/payments/v2/success',
                    configurable: true
                });
            } catch (e) {
                console.log('[TELEGRAM] ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å referrer, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤');
            }

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É
            setTimeout(() => {
                window.forceSendOrder();
            }, 1000);

            console.log('[TELEGRAM] ‚úÖ –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞');
        }
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', () => {
        interceptTildaResponse();
        watchYooKassaPayment();
    });

    // –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
    if (document.readyState !== 'loading') {
        interceptTildaResponse();
        watchYooKassaPayment();
    }

    console.log(`
=== TELEGRAM –°–ö–†–ò–ü–¢ –° –ü–û–î–î–ï–†–ñ–ö–û–ô –Æ–ö–ê–°–°–´ ===
üöÄ –°–∫—Ä–∏–ø—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!

üéØ –û–°–ù–û–í–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å –Æ–ö–∞—Å—Å—ã –ø–æ referrer
‚Ä¢ –ü–µ—Ä–µ—Ö–≤–∞—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤ Tilda
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞
‚Ä¢ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ Telegram
‚Ä¢ –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

üîß –ö–û–ú–ê–ù–î–´ –î–õ–Ø –û–¢–õ–ê–î–ö–ò:
‚Ä¢ window.telegramSimple.sendOrder() - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
‚Ä¢ window.telegramSimple.checkCustomerData() - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
‚Ä¢ window.telegramSimple.checkProducts() - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ IndexedDB
‚Ä¢ window.telegramSimple.checkOrderNumber() - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
‚Ä¢ window.telegramSimple.debugForms() - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö —Ñ–æ—Ä–º
‚Ä¢ window.telegramSimple.debugPrices() - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ü–µ–Ω —Ç–æ–≤–∞—Ä–æ–≤
‚Ä¢ window.telegramSimple.debugTracking() - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
‚Ä¢ window.telegramSimple.simulateYooKassaReturn() - —Å–∏–º—É–ª—è—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å –Æ–ö–∞—Å—Å—ã
‚Ä¢ window.forceSendOrder() - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞

üéØ –ú–ï–¢–û–î–´ –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø:
1. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç —Å yoomoney.ru (–ø–æ referrer)
2. ‚úÖ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (?payment_success=true)
3. ‚úÖ postMessage –æ—Ç –Æ–ö–∞—Å—Å—ã
4. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ localStorage

‚ö†Ô∏è –í–ê–ñ–ù–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò:
‚Ä¢ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç .js-successbox (–æ–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞)
‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –Æ–ö–∞—Å—Å–æ–π
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
‚Ä¢ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
‚Ä¢ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ window.telegramSimple.debugTracking() –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ window.telegramSimple.simulateYooKassaReturn() –¥–ª—è —Ç–µ—Å—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ window.telegramSimple.checkProducts() –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
`);
</script>