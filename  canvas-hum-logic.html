<script>
    /**
     * –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ö–æ–ª—Å—Ç–∞ - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
     * –†–ê–ó–ú–ï–©–ï–ù–ò–ï: –í –±–ª–æ–∫–µ HTML –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞ (–≤—Ç–æ—Ä—ã–º, –ø–æ—Å–ª–µ UI —Å–∫—Ä–∏–ø—Ç–∞)
     */
    // === –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ ===
    function getProductSku(container) {
        const selectors = [
            '.js-store-prod-sku',
            '[data-product-sku]',
            '.t744__sku',
            '.js-product-sku',
            '.t-product__sku',
            '.js-product .t-product__sku'
        ];

        for (const selector of selectors) {
            const element = container.querySelector(selector);
            if (element) {
                const sku = element.textContent || element.dataset.productSku || element.value;
                if (sku && sku.trim()) {
                    console.log('‚úÖ SKU –Ω–∞–π–¥–µ–Ω:', sku.trim(), '—á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä:', selector);
                    return sku.trim();
                }
            }
        }

        // –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ SKU –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        const productData = container.querySelector('[data-product-sku]');
        if (productData) {
            const sku = productData.dataset.productSku;
            if (sku && sku.trim()) {
                console.log('‚úÖ SKU –Ω–∞–π–¥–µ–Ω –≤ data-–∞—Ç—Ä–∏–±—É—Ç–µ:', sku.trim());
                return sku.trim();
            }
        }

        // –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å –∏–∑ URL
        const url = window.location.href;
        const urlMatch = url.match(/\/([^\/\?]+)(?:\?|$)/);
        if (urlMatch && urlMatch[1] && urlMatch[1] !== '') {
            console.log('‚ö†Ô∏è SKU –Ω–µ –Ω–∞–π–¥–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ URL:', urlMatch[1]);
            return urlMatch[1];
        }

        console.error('‚ùå SKU –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏–∫–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º');
        return null;
    }
    function getProductPrice(container) {
        const priceSelectors = [
            '.js-product-price',
            '.js-store-prod-price-val',
            '.t744__price-value',
            '.t-product__price-value',
            '.js-product .t-product__price-value',
            '.t744__price',
            '.t-store__prod-price',
            '[data-product-price]',
            '.js-store-prod-price',
            '.t744__price-main',
            '.t-product__price',
            '.js-product-price-def'
        ];

        for (const selector of priceSelectors) {
            const element = container.querySelector(selector);
            if (element) {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏ –æ—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
                let priceText = element.textContent || element.value || element.dataset.productPrice;
                if (priceText) {
                    // –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä –∏ —Ç–æ—á–µ–∫/–∑–∞–ø—è—Ç—ã—Ö
                    const cleanPrice = priceText.replace(/[^\d.,]/g, '');
                    if (cleanPrice) {
                        console.log('‚úÖ –¶–µ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞:', cleanPrice, '—á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä:', selector);
                        return cleanPrice;
                    }
                }
            }
        }

        // –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ –≤ data-–∞—Ç—Ä–∏–±—É—Ç–∞—Ö
        const productData = container.querySelector('[data-product-price]');
        if (productData && productData.dataset.productPrice) {
            console.log('‚úÖ –¶–µ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ data-–∞—Ç—Ä–∏–±—É—Ç–µ:', productData.dataset.productPrice);
            return productData.dataset.productPrice;
        }

        // –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ Tilda API
        if (window.tcart && window.tcart.products) {
            const sku = getProductSku(container);
            if (sku && window.tcart.products[sku]) {
                const price = window.tcart.products[sku].price;
                if (price) {
                    console.log('‚úÖ –¶–µ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞ —á–µ—Ä–µ–∑ Tilda API:', price);
                    return price;
                }
            }
        }

        // –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ —Ü–µ–Ω—É –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Tilda
        if (window.t744 && window.t744.el && window.t744.el.price) {
            console.log('‚úÖ –¶–µ–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞ —á–µ—Ä–µ–∑ t744:', window.t744.el.price);
            return window.t744.el.price;
        }

        console.error('‚ùå –¶–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return null;
    }
    function getCartDB() {
        // –ñ–¥–µ–º –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å TildaCartDB –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã
        if (window.TildaCartDB) {
            console.log('‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π TildaCartDB –Ω–∞–π–¥–µ–Ω');
            return new window.TildaCartDB();
        }

        console.warn('‚ö†Ô∏è –ì–ª–æ–±–∞–ª—å–Ω—ã–π TildaCartDB –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã...');

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º Promise, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ TildaCartDB
        return {
            _waitForTildaCartDB() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 50; // 5 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è

                    const checkInterval = setInterval(() => {
                        attempts++;

                        if (window.TildaCartDB) {
                            clearInterval(checkInterval);
                            resolve(new window.TildaCartDB());
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkInterval);
                            reject(new Error('TildaCartDB –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∫–æ—Ä–∑–∏–Ω—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º.'));
                        }
                    }, 100);
                });
            },

            async init() {
                const db = await this._waitForTildaCartDB();
                return db.init();
            },

            async saveProduct(data) {
                const db = await this._waitForTildaCartDB();
                return db.saveProduct(data);
            },

            async getAllProducts() {
                const db = await this._waitForTildaCartDB();
                return db.getAllProducts();
            },

            async clearAllProducts() {
                const db = await this._waitForTildaCartDB();
                return db.clearAllProducts();
            },

            async getProductBySku(sku) {
                const db = await this._waitForTildaCartDB();
                return db.getProductBySku(sku);
            },

            async removeProductBySku(sku) {
                const db = await this._waitForTildaCartDB();
                return db.removeProductBySku(sku);
            }
        };
    }
    // === –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç ===
    document.addEventListener('DOMContentLoaded', () => {
        console.log('üñºÔ∏è –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç —Ö–æ–ª—Å—Ç–∞ –∑–∞–ø—É—â–µ–Ω');
        let initAttempts = 0;
        const maxAttempts = 15;

        function initializeLogic() {
            initAttempts++;
            console.log(`üîß –õ–æ–≥–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ${initAttempts}/${maxAttempts}`);

            const productContainer = document.getElementById('rec1174632996');

            if (!productContainer) {
                console.warn('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä rec1174632996 –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –ª–æ–≥–∏–∫–∏');
                return false;
            }
            console.log('‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–π–¥–µ–Ω –¥–ª—è –ª–æ–≥–∏–∫–∏:', productContainer);
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–ø—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const imageOption = productContainer.querySelector('.js-product-edition-option[data-edition-option-id="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"]');

            if (!imageOption) {
                console.warn('‚ùå –û–ø—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è –ª–æ–≥–∏–∫–∏');
                return false;
            }
            setupLogic(productContainer);
            return true;
        }
        // –ü—Ä–æ–±—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã UI —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
        setTimeout(() => {
            if (!initializeLogic()) {
                console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –ª–æ–≥–∏–∫–∏...');

                const checkInterval = setInterval(() => {
                    if (initializeLogic()) {
                        clearInterval(checkInterval);
                    } else if (initAttempts >= maxAttempts) {
                        clearInterval(checkInterval);
                        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–æ—Å–ª–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫');
                    }
                }, 1000);
            }
        }, 500);
        function setupLogic(productContainer) {
            console.log('‚öôÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ª–æ–≥–∏–∫—É...');

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            const cartDB = getCartDB();
            cartDB.init().catch(console.error);
            // === –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É ===
            function setupCartHandler() {
                const cartBtn = productContainer.querySelector('.js-store-prod-buy-btn-txt');
                if (!cartBtn) return false;
                const btn = cartBtn.closest('.t744__btn');
                if (!btn) return false;
                console.log('üõí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ—Ä–∑–∏–Ω—ã');
                btn.addEventListener('click', async function (e) {
                    console.log('üõí –ö–Ω–æ–ø–∫–∞ "–≤ –∫–æ—Ä–∑–∏–Ω—É" –Ω–∞–∂–∞—Ç–∞');

                    try {
                        // –ü–æ–ª—É—á–∞–µ–º SKU
                        const sku = getProductSku(productContainer);
                        if (!sku) {
                            e.preventDefault();
                            if (window.showNotification) {
                                window.showNotification('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞', 'error');
                            } else {
                                alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞');
                            }
                            return;
                        }
                        // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª
                        const fileInput = productContainer.querySelector('.aiva-file-input');
                        const file = fileInput && fileInput.files[0] ? fileInput.files[0] : null;

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞
                        if (!file) {
                            e.preventDefault();
                            if (window.showNotification) {
                                window.showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Å–≤–æ–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞', 'warning');
                            } else {
                                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Å–≤–æ–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞');
                            }
                            return;
                        }
                        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                        const productNameElement = productContainer.querySelector('.js-product-name');
                        const productName = productNameElement ? productNameElement.textContent.trim() : '';
                        // –ü–æ–ª—É—á–∞–µ–º –ê–ö–¢–£–ê–õ–¨–ù–£–Æ —Ü–µ–Ω—É
                        const productPrice = getProductPrice(productContainer);
                        console.log('üñºÔ∏è –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞:', {
                            sku, productName, price: productPrice, hasFile: !!file
                        });
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                        const saveIndicator = document.createElement('div');
                        saveIndicator.className = 'aiva-save-indicator';
                        saveIndicator.textContent = '–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—é...';
                        btn.appendChild(saveIndicator);
                        try {
                            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª –≤ base64 –ë–ï–ó –°–ñ–ê–¢–ò–Ø
                            const fileBase64 = await new Promise((resolve, reject) => {
                                const reader = new FileReader();
                                reader.onload = () => resolve(reader.result);
                                reader.onerror = reject;
                                reader.readAsDataURL(file);
                            });

                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ IndexedDB
                            const productData = {
                                sku: sku,
                                productName: productName,
                                price: productPrice, // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
                                file: {
                                    name: file.name,
                                    size: file.size,
                                    type: file.type,
                                    data: fileBase64
                                },
                                text: '', // –î–ª—è —Ö–æ–ª—Å—Ç–∞ —Ç–µ–∫—Å—Ç –Ω–µ –Ω—É–∂–µ–Ω
                                timestamp: Date.now()
                            };
                            await cartDB.saveProduct(productData);

                            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ IndexedDB');

                            // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                            saveIndicator.remove();

                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                            if (window.showNotification) {
                                window.showNotification('‚úÖ –í–∞—à–∞ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                            }

                            // –ù–ï –±–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É

                        } catch (saveError) {
                            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ IndexedDB:', saveError);
                            saveIndicator.remove();

                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
                            if (window.showNotification) {
                                window.showNotification('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—é', 'error');
                            }
                        }

                    } catch (error) {
                        console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ:', error);
                        e.preventDefault();
                        if (window.showNotification) {
                            window.showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                        } else {
                            alert('–û—à–∏–±–∫–∞: ' + error.message);
                        }
                    }
                });
                return true;
            }
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ—Ä–∑–∏–Ω—ã
            setTimeout(() => {
                if (!setupCartHandler()) {
                    console.log('‚è≥ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ—Ä–∑–∏–Ω—ã –Ω–µ –≥–æ—Ç–æ–≤, –Ω–∞–±–ª—é–¥–∞–µ–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏...');
                    const observer = new MutationObserver(() => {
                        if (setupCartHandler()) {
                            console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ—Ä–∑–∏–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ observer');
                            observer.disconnect();
                        }
                    });
                    observer.observe(productContainer, { childList: true, subtree: true });
                }
            }, 1000);
        }
        // === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ ===
        window.debugCanvas = {
            async checkStorage() {
                try {
                    const cartDB = getCartDB();
                    const products = await cartDB.getAllProducts();
                    console.log('üóÑÔ∏è –¢–æ–≤–∞—Ä—ã –≤ IndexedDB:', products);
                    return products;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è IndexedDB:', error);
                    return [];
                }
            },
            async clearStorage() {
                try {
                    const cartDB = getCartDB();
                    await cartDB.clearAllProducts();
                    console.log('üóëÔ∏è IndexedDB –æ—á–∏—â–µ–Ω–æ');
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ IndexedDB:', error);
                }
            },
            checkSku() {
                const container = document.getElementById('rec1174632996');
                if (container) {
                    const sku = getProductSku(container);
                    console.log('üè∑Ô∏è SKU —Ç–æ–≤–∞—Ä–∞:', sku);
                    return sku;
                }
                return null;
            },
            checkPrice() {
                const container = document.getElementById('rec1174632996');
                if (container) {
                    const price = getProductPrice(container);
                    console.log('üí∞ –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞:', price);
                    return price;
                }
                return null;
            },
            async checkProductBySku(sku) {
                try {
                    const cartDB = getCartDB();
                    const product = await cartDB.getProductBySku(sku);
                    console.log('üì¶ –¢–æ–≤–∞—Ä –ø–æ SKU:', sku, product);
                    return product;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞:', error);
                    return null;
                }
            },
            async removeProductBySku(sku) {
                try {
                    const cartDB = getCartDB();
                    await cartDB.removeProductBySku(sku);
                    console.log('üóëÔ∏è –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –ø–æ SKU:', sku);
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error);
                }
            },
            async refreshProductData() {
                try {
                    const container = document.getElementById('rec1174632996');
                    if (!container) return;

                    const sku = getProductSku(container);
                    if (!sku) return;

                    const cartDB = getCartDB();

                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ SKU
                    await cartDB.removeProductBySku(sku);
                    console.log('üóëÔ∏è –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã –¥–ª—è SKU:', sku);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
                    const currentPrice = getProductPrice(container);
                    console.log('üí∞ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:', currentPrice);

                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                }
            },
            async simulateAddToCart() {
                const container = document.getElementById('rec1174632996');
                if (!container) return false;

                const sku = getProductSku(container);
                const price = getProductPrice(container);
                const fileInput = container.querySelector('.aiva-file-input');

                console.log('üõí –°–∏–º—É–ª—è—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É:', {
                    sku,
                    price,
                    hasFile: !!(fileInput && fileInput.files[0])
                });

                return true;
            },
            async testIndexedDB() {
                try {
                    const cartDB = getCartDB();
                    await cartDB.init();

                    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    const testData = {
                        sku: 'TEST_CANVAS_' + Date.now(),
                        productName: '–¢–µ—Å—Ç–æ–≤—ã–π —Ö–æ–ª—Å—Ç',
                        price: '6900',
                        text: '',
                        file: {
                            name: 'test.jpg',
                            size: 1024,
                            type: 'image/jpeg',
                            data: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k='
                        }
                    };

                    console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...');
                    await cartDB.saveProduct(testData);

                    console.log('üìñ –ß–∏—Ç–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ...');
                    const allProducts = await cartDB.getAllProducts();
                    console.log('üì¶ –í—Å–µ —Ç–æ–≤–∞—Ä—ã:', allProducts);

                    console.log('üîç –ò—â–µ–º –ø–æ SKU...');
                    const foundProduct = await cartDB.getProductBySku(testData.sku);
                    console.log('üì¶ –ù–∞–π–¥–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä:', foundProduct);

                    console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...');
                    await cartDB.removeProductBySku(testData.sku);

                    console.log('‚úÖ –¢–µ—Å—Ç IndexedDB –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    return true;

                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è IndexedDB:', error);
                    return false;
                }
            },
            // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ü–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            debugPriceElements() {
                const container = document.getElementById('rec1174632996');
                if (!container) return;

                console.log('üí∞ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –≠–õ–ï–ú–ï–ù–¢–û–í –¶–ï–ù–´:');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                const allSelectors = [
                    '.js-product-price',
                    '.js-store-prod-price-val',
                    '.t744__price-value',
                    '.t-product__price-value',
                    '.js-product .t-product__price-value',
                    '.t744__price',
                    '.t-store__prod-price',
                    '[data-product-price]',
                    '.js-store-prod-price',
                    '.t744__price-main',
                    '.t-product__price',
                    '.js-product-price-def'
                ];

                allSelectors.forEach(selector => {
                    const elements = container.querySelectorAll(selector);
                    if (elements.length > 0) {
                        console.log(`üí∞ ${selector}:`, Array.from(elements).map(el => ({
                            text: el.textContent,
                            value: el.value,
                            dataset: el.dataset
                        })));
                    }
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
                console.log('üåê –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:');
                if (window.tcart) console.log('tcart:', window.tcart);
                if (window.t744) console.log('t744:', window.t744);
            }
        };
        // –ù–ï –æ–±—ä—è–≤–ª—è–µ–º TildaCartDB —Å–Ω–æ–≤–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã
        console.log('‚ÑπÔ∏è –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç —Ö–æ–ª—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TildaCartDB –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã');
    });
    console.log(`
=== –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ –õ–û–ì–ò–ß–ï–°–ö–û–ì–û –°–ö–†–ò–ü–¢–ê –•–û–õ–°–¢–ê ===
üñºÔ∏è –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç —Ö–æ–ª—Å—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!
üöÄ –û–°–ù–û–í–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ IndexedDB
‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π Tilda
‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–∏—Ç–æ–º—Ü–µ–≤
‚Ä¢ –ü–æ–ª—É—á–µ–Ω–∏–µ SKU —Ç–æ–≤–∞—Ä–∞
‚Ä¢ –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞
üîß –ö–û–ú–ê–ù–î–´ –î–õ–Ø –û–¢–õ–ê–î–ö–ò:
‚Ä¢ window.debugCanvas.checkStorage() - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚Ä¢ window.debugCanvas.clearStorage() - –æ—á–∏—Å—Ç–∏—Ç—å IndexedDB
‚Ä¢ window.debugCanvas.checkSku() - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å SKU —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞
‚Ä¢ window.debugCanvas.checkPrice() - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–Ω—É —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞
‚Ä¢ window.debugCanvas.checkProductBySku('SKU') - –Ω–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –ø–æ SKU
‚Ä¢ window.debugCanvas.removeProductBySku('SKU') - —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ SKU
‚Ä¢ window.debugCanvas.refreshProductData() - –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
‚Ä¢ window.debugCanvas.simulateAddToCart() - —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
‚Ä¢ window.debugCanvas.testIndexedDB() - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å IndexedDB
‚Ä¢ window.debugCanvas.debugPriceElements() - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ü–µ–Ω—ã
üìÇ –•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•:
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ IndexedDB (localStorage –æ—Ç–∫–ª—é—á–µ–Ω)
‚Ä¢ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ë–ï–ó –°–ñ–ê–¢–ò–Ø –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –∫–∞—á–µ—Å—Ç–≤–µ
‚Ä¢ –î–∞–Ω–Ω—ã–µ —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –ø–æ SKU
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞
‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:
‚Ä¢ –°–∫—Ä–∏–ø—Ç –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É Tilda
‚Ä¢ –§–∞–π–ª –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å rec1174632996
‚Ä¢ –¢—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ UI —Å–∫—Ä–∏–ø—Ç–∞
‚Ä¢ –¶–µ–Ω–∞ —á–∏—Ç–∞–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
üõ†Ô∏è –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú –° –¶–ï–ù–û–ô:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ window.debugCanvas.debugPriceElements() –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ window.debugCanvas.checkPrice() –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞
3. –û—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ window.debugCanvas.refreshProductData()
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —á–µ—Ä–µ–∑ window.debugCanvas.checkStorage()
`);
</script>